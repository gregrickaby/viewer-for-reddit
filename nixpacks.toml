# nixpacks.toml
providers = ["node"]

[phases.setup]
# Pin to specific versions of node.
# Use nodejs_24 from nixpkgs https://search.nixos.org/packages?channel=25.11&show=nodejs_24&query=nodejs_24
nixPkgs = ["nodejs_24"]
nixpkgsArchive = "2c3e5ec5df46d3aeee2a1da0bfedd74e21f4bf3a"

[phases.install]
# Use npm i (not ci) to resolve linux binaries in dependencies.
# Ensures native modules are compiled for the target platform.
cmds = ["npm i --omitDev"]
cacheDirectories = ["/root/.npm"]

[phases.build]
# Build the Next.js application with production optimizations.
cmds = ["npm run build"]

# Cache both Next.js and module caches for faster rebuilds
cacheDirectories = [".next/cache", "node_modules/.cache"]

[start]
# Use production Next.js server.
cmd = "npm run start"
